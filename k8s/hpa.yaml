apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: comedy-backend-hpa
  namespace: comedy-discovery
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: comedy-backend
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80

---

apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: comedy-frontend-hpa
  namespace: comedy-discovery
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: comedy-frontend
  minReplicas: 2
  maxReplicas: 6
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70

---

# monitoring/prometheus-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: comedy-discovery
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
    scrape_configs:
    - job_name: 'comedy-backend'
      static_configs:
      - targets: ['comedy-backend-service:8000']
      metrics_path: '/metrics'
    - job_name: 'redis'
      static_configs:
      - targets: ['redis-service:6379']
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
      - role: pod
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true